<!--
Stacks its child elements on top of each other, taking on the maximum height
and width of the child elements.
-->

<link rel="import" href="../basic-element/basic-element.html">
<script src="../basic-helpers/BasicResizeHelpers.js"></script>

<polymer-element name="basic-stack" extends="basic-element">
<template>
  <style>
  :host {
    box-sizing: border-box;
    display: block;
    position: relative;
  }

  #stackContainer {
    left: 0;
    top: 0;
    width: 100%;
  }

  polyfill-next-selector {
    content: '#stackContainer > *';
  }
  ::content > * {
    position: absolute;
  }
  </style>
  <div id="stackContainer">
    <content id="content"></content>
  </div>
</template>
<script>
Polymer(Platform.mixin({

  attached: function() {
    this.super();
    this.listenForResize();
  },

  contentChanged: function() {
    setTimeout( function() {
      this.recalc();    
    }.bind( this ));
  },

  detached: function() {
    this.super();
    this.listenForResize(false);
  },

  recalc: function() {
    this.log( "recalc" );
    var contentNodes = this.flattenChildren;
    var maxWidth = 0;
    var maxHeight = 0;
    Array.prototype.forEach.call( contentNodes, function( node ) {
      if ( node.offsetWidth ) {
        maxWidth = Math.max( maxWidth, node.offsetWidth );
      }
      if ( node.offsetHeight ) {
        maxHeight = Math.max( maxHeight, node.offsetHeight );
      }
    });
    maxWidth = Math.ceil( maxWidth ); // Round up to avoid layout problems.
    var width = maxWidth
      ? maxWidth + "px"
      : null;
    var height = maxHeight
      ? maxHeight + "px"
      : null;
    this.$.stackContainer.style.width = width;
    this.$.stackContainer.style.height = height;    

    var event = new CustomEvent( "basic-stack-resize", {
      detail: {
        count: contentNodes.length,
        height: parseInt( height ),
        width: parseInt( width )
      }
    });
    this.dispatchEvent( event );
  },

  resized: function( event ) {
    var foo = this.$.stackContainer.style;
    this.$.stackContainer.style.width = "100%";
    this.recalc();
  }

}, BasicResizeHelpers));
</script>
</polymer-element>
